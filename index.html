<!DOCTYPE html>
<html lang="ms">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jurnal Al-Quran Harian</title>
    <link rel="stylesheet" href="style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Amiri:ital,wght@0,400;0,700;1,400&family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <!-- Login Container -->
    <div id="loginContainer" class="login-container">
        <div class="login-card">
            <div class="login-header">
                <h1><i class="fas fa-book-quran"></i> Jurnal Al-Quran</h1>
                <p>Selamat datang ke sistem jurnal peribadi anda</p>
            </div>
            <form id="loginForm">
                <div class="form-group">
                    <label for="username">Username</label>
                    <input type="text" id="username" placeholder="Masukkan username" required>
                </div>
                <div class="form-group">
                    <label for="password">Password</label>
                    <input type="password" id="password" placeholder="Masukkan password" required>
                </div>
                <button type="submit" class="btn-primary">Log Masuk</button>
                <div id="loginError" class="error-message" style="display: none;"></div>
            </form>
        </div>
    </div>

    <!-- Main App Container -->
    <div id="appContainer" class="app-container" style="display: none;">
        <!-- Header -->
        <header class="header">
            <div class="header-left">
                <button id="menuToggle" class="menu-toggle">
                    <i class="fas fa-bars"></i>
                </button>
                <h1><i class="fas fa-book-quran"></i> Jurnal Al-Quran</h1>
            </div>
            <div class="header-right">
                <div class="user-info">
                    <div id="userAvatar" class="user-avatar">A</div>
                    <span id="userDisplay">Admin</span>
                </div>
                <button id="logoutBtn" class="btn-secondary">Log Keluar</button>
            </div>
        </header>

        <div class="app-body">
            <!-- Sidebar -->
            <aside id="sidebar" class="sidebar">
                <div class="sidebar-header">
                    <h2>Menu</h2>
                </div>
                <ul class="sidebar-menu">
                    <li><a href="#journal-tab" class="menu-item active" data-tab="journal"><i class="fas fa-pen"></i> Catatan Peribadi</a></li>
                    <li><a href="#public-tab" class="menu-item" data-tab="public"><i class="fas fa-users"></i> Catatan Awam</a></li>
                    <li><a href="#quran-tab" class="menu-item" data-tab="quran"><i class="fas fa-book-open"></i> Rujukan Al-Quran</a></li>
                </ul>
            </aside>

            <!-- Main Content -->
            <main class="main-content">
                <!-- Tab Navigation -->
                <div class="tab-navigation">
                    <button class="tab active" data-tab="journal">Catatan Peribadi</button>
                    <button class="tab" data-tab="public">Catatan Awam</button>
                    <button class="tab" data-tab="quran">Rujukan Al-Quran</button>
                </div>

                <!-- Tab Contents -->
                <div class="tab-contents">
                    <!-- Journal Tab -->
                    <div id="journal-tab" class="tab-content active">
                        <div class="journal-form">
                            <h2>Tulis Catatan Baru</h2>
                            <form id="journalForm">
                                <div class="form-group">
                                    <label for="journalTitle">Judul Catatan</label>
                                    <input type="text" id="journalTitle" placeholder="Berikan judul untuk catatan anda" required>
                                </div>
                                <div class="form-group">
                                    <label for="journalContent">Isi Catatan</label>
                                    <textarea id="journalContent" rows="8" placeholder="Tuliskan pemikiran, refleksi, atau apa-apa sahaja yang anda rasakan hari ini..." required></textarea>
                                </div>
                                <div class="form-group">
                                    <label for="journalVisibility">Visibiliti</label>
                                    <select id="journalVisibility">
                                        <option value="private">Peribadi (Hanya anda yang boleh lihat)</option>
                                        <option value="public">Awam (Semua pengguna boleh lihat)</option>
                                    </select>
                                </div>
                                <div class="form-actions">
                                    <button type="submit" class="btn-primary">Simpan Catatan</button>
                                    <button type="button" id="clearBtn" class="btn-secondary">Kosongkan</button>
                                </div>
                            </form>
                        </div>

                        <div class="journal-entries">
                            <div class="entries-header">
                                <h2>Senarai Catatan Peribadi</h2>
                                <span id="entryCountPrivate">0 catatan</span>
                            </div>
                            <div id="entriesContainerPrivate" class="entries-container">
                                <!-- Entries will be loaded here -->
                            </div>
                        </div>
                    </div>

                    <!-- Public Tab -->
                    <div id="public-tab" class="tab-content">
                        <div class="journal-entries">
                            <div class="entries-header">
                                <h2>Senarai Catatan Awam</h2>
                                <span id="entryCountPublic">0 catatan</span>
                            </div>
                            <div id="entriesContainerPublic" class="entries-container">
                                <!-- Entries will be loaded here -->
                            </div>
                        </div>
                    </div>

                    <!-- Quran Tab -->
                    <div id="quran-tab" class="tab-content">
                        <div class="quran-container">
                            <div class="quran-controls">
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="surahSelect">Pilih Surah</label>
                                        <select id="surahSelect">
                                            <!-- Surah options will be populated by JavaScript -->
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="ayatIndex">Nomor Ayat</label>
                                        <input type="number" id="ayatIndex" min="1" value="1" placeholder="1">
                                    </div>
                                </div>
                                <div class="form-actions">
                                    <button id="loadAyatBtn" class="btn-primary">Muat Ayat</button>
                                    <button id="prevAyatBtn" class="btn-secondary"><i class="fas fa-chevron-left"></i> Ayat Sebelumnya</button>
                                    <button id="nextAyatBtn" class="btn-secondary">Ayat Berikutnya <i class="fas fa-chevron-right"></i></button>
                                </div>
                            </div>
                            <div id="ayat-display" class="ayat-display">
                                <div class="placeholder">
                                    <i class="fas fa-book-quran"></i>
                                    <p>Pilih surah dan ayat untuk memulakan</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Entry Modal -->
    <div id="entryModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalTitle">Judul Catatan</h3>
                <button id="closeModal" class="modal-close">&times;</button>
            </div>
            <div id="modalBody" class="modal-body">
                <!-- Entry details will be loaded here -->
            </div>
        </div>
    </div>

    <!-- Calendar Modal -->
    <div id="calendarModal" class="calendar-modal">
        <!-- Calendar will be rendered here -->
    </div>

    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>

    <script>
        // --- PERSIAPAN FIREBASE ---
        <script type="module">
  // Import the functions you need from the SDKs you need
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
  import { getAnalytics } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-analytics.js";
  // TODO: Add SDKs for Firebase products that you want to use
  // https://firebase.google.com/docs/web/setup#available-libraries

  // Your web app's Firebase configuration
  // For Firebase JS SDK v7.20.0 and later, measurementId is optional
  const firebaseConfig = {
    apiKey: "AIzaSyD2bg7IeRz4bR7dMkTHJo9T_Macy16COpc",
    authDomain: "jurnal-al-quran-6ca7c.firebaseapp.com",
    projectId: "jurnal-al-quran-6ca7c",
    storageBucket: "jurnal-al-quran-6ca7c.firebasestorage.app",
    messagingSenderId: "175103376818",
    appId: "1:175103376818:web:6978f520cf9084b06ab8ab",
    measurementId: "G-6TZ2YDZYS1"
  };


        // Inisialisasi Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
        // --- TAMAT PERSIAPAN FIREBASE ---

        // DOM Elements
        const loginContainer = document.getElementById('loginContainer');
        const appContainer = document.getElementById('appContainer');
        const loginForm = document.getElementById('loginForm');
        const loginError = document.getElementById('loginError');
        const logoutBtn = document.getElementById('logoutBtn');
        const userDisplay = document.getElementById('userDisplay');
        const userAvatar = document.getElementById('userAvatar');
        const menuToggle = document.getElementById('menuToggle');
        const sidebar = document.getElementById('sidebar');
        const journalForm = document.getElementById('journalForm');
        const journalTitle = document.getElementById('journalTitle');
        const journalContent = document.getElementById('journalContent');
        const journalVisibility = document.getElementById('journalVisibility');
        const clearBtn = document.getElementById('clearBtn');
        const entriesContainerPrivate = document.getElementById('entriesContainerPrivate');
        const entriesContainerPublic = document.getElementById('entriesContainerPublic');
        const entryCountPrivate = document.getElementById('entryCountPrivate');
        const entryCountPublic = document.getElementById('entryCountPublic');
        const entryModal = document.getElementById('entryModal');
        const modalTitle = document.getElementById('modalTitle');
        const modalBody = document.getElementById('modalBody');
        const closeModal = document.getElementById('closeModal');
        const surahSelect = document.getElementById('surahSelect');
        const ayatIndex = document.getElementById('ayatIndex');
        const loadAyatBtn = document.getElementById('loadAyatBtn');
        const prevAyatBtn = document.getElementById('prevAyatBtn');
        const nextAyatBtn = document.getElementById('nextAyatBtn');
        const ayatDisplay = document.getElementById('ayat-display');

        // State
        let currentUser = null;
        let journalEntries = [];
        let selectedAyat = null;
        let currentSurah = null;
        let currentAyat = null;

        // Surah names and ayat counts
        const surahNames = [
            "Al-Fatihah", "Al-Baqarah", "Ali 'Imran", "An-Nisa'", "Al-Ma'idah", "Al-An'am", "Al-A'raf", "Al-Anfal", "At-Taubah", "Yunus",
            "Hud", "Yusuf", "Ar-Ra'd", "Ibrahim", "Al-Hijr", "An-Nahl", "Al-Isra'", "Al-Kahf", "Maryam", "Taha",
            "Al-Anbiya'", "Al-Hajj", "Al-Mu'minun", "An-Nur", "Al-Furqan", "Asy-Syu'ara'", "An-Naml", "Al-Qasas", "Al-'Ankabut", "Ar-Rum",
            "Luqman", "As-Sajdah", "Al-Ahzab", "Saba'", "Fatir", "Ya Sin", "As-Saffat", "Sad", "Az-Zumar", "Ghafir",
            "Fussilat", "Asy-Syura", "Az-Zukhruf", "Ad-Dukhan", "Al-Jatsiyah", "Al-Ahqaf", "Muhammad", "Al-Fath", "Al-Hujurat", "Qaf",
            "Adz-Dzariyat", "At-Tur", "An-Najm", "Al-Qamar", "Ar-Rahman", "Al-Waqi'ah", "Al-Hadid", "Al-Mujadilah", "Al-Hasyr", "Al-Mumtahanah",
            "As-Saff", "Al-Jumu'ah", "Al-Munafiqun", "At-Taghabun", "At-Talaq", "At-Tahrim", "Al-Mulk", "Al-Qalam", "Al-Haqqah", "Al-Ma'arij",
            "Nuh", "Al-Jinn", "Al-Muzzammil", "Al-Muddatsir", "Al-Qiyamah", "Al-Insan", "Al-Mursalat", "An-Naba'", "An-Nazi'at", "'Abasa",
            "At-Takwir", "Al-Infitar", "Al-Mutaffifin", "Al-Insyiqaq", "Al-Buruj", "At-Tariq", "Al-A'la", "Al-Ghasyiyah", "Al-Fajr", "Al-Balad",
            "Asy-Syams", "Al-Lail", "Adh-Dhuha", "Al-Insyirah", "At-Tin", "Al-'Alaq", "Al-Qadar", "Al-Bayyinah", "Az-Zalzalah", "Al-'Adiyat",
            "Al-Qari'ah", "At-Takasur", "Al-Asr", "Al-Humazah", "Al-Fil", "Quraisy", "Al-Ma'un", "Al-Kautsar", "Al-Kafirun", "An-Nasr",
            "Al-Ikhlas", "Al-Falaq", "An-Nas"
        ];
        const surahAyatCounts = [
            7, 286, 200, 176, 120, 165, 206, 75, 129, 109, 123, 111, 43, 52, 99, 128, 111, 110, 98, 135,
            112, 78, 118, 64, 77, 227, 93, 88, 69, 60, 34, 30, 73, 54, 45, 83, 182, 88, 75, 85,
            54, 53, 89, 59, 37, 35, 38, 29, 18, 45, 60, 49, 62, 55, 78, 96, 29, 22, 24, 13,
            14, 11, 11, 18, 12, 12, 30, 52, 52, 44, 28, 28, 20, 15, 21, 11, 11, 15, 8, 8,
            19, 5, 8, 8, 11, 11, 8, 8, 10, 6, 4, 7, 3, 6, 3, 5, 4, 5, 6, 4
        ];

        // Initialize app
        function init() {
            // Set up event listeners
            loginForm.addEventListener('submit', handleLogin);
            logoutBtn.addEventListener('click', handleLogout);
            journalForm.addEventListener('submit', saveJournalEntry);
            clearBtn.addEventListener('click', clearForm);
            closeModal.addEventListener('click', () => entryModal.classList.remove('active'));
            
            // Mobile menu toggle
            menuToggle.addEventListener('click', () => document.body.classList.toggle('sidebar-open'));
            document.addEventListener('click', (e) => {
                if (window.innerWidth <= 768 && !sidebar.contains(e.target) && !menuToggle.contains(e.target) && document.body.classList.contains('sidebar-open')) {
                    document.body.classList.remove('sidebar-open');
                }
            });

            // Tab switching
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', () => {
                    const tabName = tab.dataset.tab;
                    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');
                    document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
                    document.getElementById(`${tabName}-tab`).classList.add('active');
                    if (tabName === 'journal') displayEntries('private');
                    if (tabName === 'public') displayEntries('public');
                });
            });

            // Initialize Quran controls
            initializeQuranControls();
        }

        // Initialize Quran controls
        function initializeQuranControls() {
            surahNames.forEach((name, index) => {
                const option = document.createElement('option');
                option.value = index + 1;
                option.textContent = `${index + 1}. ${name}`;
                surahSelect.appendChild(option);
            });

            loadAyatBtn.addEventListener('click', () => {
                const surah = parseInt(surahSelect.value);
                const ayat = parseInt(ayatIndex.value);
                if (surah && ayat) loadAyat(surah, ayat);
            });

            prevAyatBtn.addEventListener('click', () => {
                if (currentSurah > 1 && currentAyat > 1) loadAyat(currentSurah, currentAyat - 1);
            });

            nextAyatBtn.addEventListener('click', () => {
                if (currentSurah && currentAyat && currentAyat < surahAyatCounts[currentSurah - 1]) {
                    loadAyat(currentSurah, currentAyat + 1);
                }
            });
        }

        // Load Quran verses using API
        function loadAyat(surah, ayat) {
            currentSurah = surah;
            currentAyat = ayat;
            surahSelect.value = surah;
            ayatIndex.value = ayat;
            prevAyatBtn.disabled = (surah === 1 && ayat === 1);
            nextAyatBtn.disabled = (ayat >= surahAyatCounts[surah - 1]);

            ayatDisplay.innerHTML = `<div class="loading"><div class="loading-spinner"></div><p>Memuatkan ayat...</p></div>`;

            fetch(`https://api.alquran.cloud/v1/ayah/${surah}:${ayat}/editions/quran-uthmani,id.indonesian`)
                .then(response => response.json())
                .then(data => {
                    if (data.data && data.data.length >= 2) {
                        const arabicText = data.data[0].text;
                        const terjemahanText = data.data[1].text;
                        const refText = `${surahNames[surah-1]} (${surah}:${ayat})`;

                        selectedAyat = { ref: refText, arabic: arabicText, terjemahan: terjemahanText };

                        ayatDisplay.innerHTML = `
                            <div class="ayat-box">
                                <div class="surah-name">${refText}</div>
                                <div class="arabic">${arabicText}</div>
                                <div class="terjemahan">${terjemahanText}</div>
                                <div class="ayat-actions">
                                    <button class="btn-small btn-copy" onclick="copyAyat()">Salin</button>
                                    <button class="btn-small btn-add-journal" onclick="addToJournal()">Tambah ke Catatan</button>
                                </div>
                            </div>
                        `;
                    } else {
                        throw new Error('Data not found');
                    }
                })
                .catch(err => {
                    console.error(err);
                    ayatDisplay.innerHTML = `<div class="error-message">Gagal memuatkan ayat. Sila semak sambungan internet.</div>`;
                });
        }

        function copyAyat() {
            if (!selectedAyat) return;
            const textToCopy = `${selectedAyat.ref}\n\n${selectedAyat.arabic}\n\nTerjemahan:\n${selectedAyat.terjemahan}`;
            navigator.clipboard.writeText(textToCopy).then(() => showNotification('Ayat berjaya disalin!', 'success'))
                .catch(() => showNotification('Gagal menyalin ayat', 'error'));
        }

        function addToJournal() {
            if (!selectedAyat) return;
            document.querySelector('[data-tab="journal"]').click();
            const ayatText = `\n\n---\n${selectedAyat.ref}\n${selectedAyat.arabic}\n\n${selectedAyat.terjemahan}\n---`;
            journalContent.value += ayatText;
            document.querySelector('.journal-form').scrollIntoView({ behavior: 'smooth' });
            showNotification('Ayat ditambah ke catatan', 'success');
        }

        // --- LOGIK FIREBASE ---

        // Listener untuk status pengguna
        auth.onAuthStateChanged(user => {
            if (user) {
                currentUser = user.email.split('@')[0]; // Ambil username dari e-mel
                showApp();
                loadEntriesFromFirestore();
            } else {
                currentUser = null;
                loginContainer.style.display = 'flex';
                appContainer.style.display = 'none';
            }
        });

        // Handle login
        async function handleLogin(e) {
            e.preventDefault();
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            const email = `${username}@example.com`; // Anggap username adalah bahagian depan e-mel
            
            try {
                await auth.signInWithEmailAndPassword(email, password);
                loginError.style.display = 'none';
            } catch (error) {
                loginError.textContent = 'Username atau password salah. ' + error.message;
                loginError.style.display = 'block';
            }
        }

        // Handle logout
        function handleLogout() {
            auth.signOut();
        }

        // Show app after login
        function showApp() {
            loginContainer.style.display = 'none';
            appContainer.style.display = 'block';
            userDisplay.textContent = currentUser;
            userAvatar.textContent = currentUser.charAt(0).toUpperCase();
        }

        // Muat semua catatan dari Firestore
        async function loadEntriesFromFirestore() {
            try {
                const snapshot = await db.collection('entries').orderBy('date', 'desc').get();
                journalEntries = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                
                const activeTab = document.querySelector('.tab.active').dataset.tab;
                displayEntries(activeTab === 'public' ? 'public' : 'private');
            } catch (error) {
                console.error("Error loading entries: ", error);
                showNotification('Gagal memuatkan catatan.', 'error');
            }
        }

        // Save journal entry to Firestore
        async function saveJournalEntry(e) {
            e.preventDefault();
            const title = journalTitle.value.trim();
            const content = journalContent.value.trim();
            const visibility = journalVisibility.value;
            
            if (!title || !content) {
                showNotification('Judul dan isi catatan tidak boleh kosong.', 'error');
                return;
            }

            const entry = {
                title: title,
                content: content,
                date: firebase.firestore.Timestamp.now(), // Gunakan Timestamp Firestore
                visibility: visibility,
                author: currentUser,
                verse: selectedAyat ? { ref: selectedAyat.ref, text: selectedAyat.arabic, translation: selectedAyat.terjemahan } : null
            };

            try {
                await db.collection('entries').add(entry);
                await loadEntriesFromFirestore(); // Muat semula senarai
                clearForm();
                showNotification('Catatan berjaya disimpan!', 'success');
            } catch (error) {
                console.error("Error saving document: ", error);
                showNotification('Gagal menyimpan catatan.', 'error');
            }
        }

        // Delete entry from Firestore
        async function deleteEntry(id) {
            if (!confirm('Adakah anda pasti ingin memadam catatan ini?')) return;

            try {
                await db.collection('entries').doc(id).delete();
                await loadEntriesFromFirestore(); // Muat semula senarai
                showNotification('Catatan berjaya dipadam.', 'success');
            } catch (error) {
                console.error("Error deleting document: ", error);
                showNotification('Gagal memadam catatan.', 'error');
            }
        }

        // --- TAMAT LOGIK FIREBASE ---

        // Helper functions
        function showNotification(message, type) {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            notification.style.cssText = `
                position: fixed; top: 20px; right: 20px; z-index: 1000;
                background: ${type === 'success' ? '#48bb78' : '#e53e3e'}; color: white;
                padding: 12px 20px; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            `;
            document.body.appendChild(notification);
            setTimeout(() => {
                notification.style.display = 'none';
                document.body.removeChild(notification);
            }, 3000);
        }

        function clearForm() {
            journalTitle.value = '';
            journalContent.value = '';
            journalVisibility.value = 'private';
        }

        function displayEntries(filter = 'private') {
            const filteredEntries = journalEntries.filter(entry => entry.visibility === filter);
            const container = filter === 'private' ? entriesContainerPrivate : entriesContainerPublic;
            const countElement = filter === 'private' ? entryCountPrivate : entryCountPublic;

            countElement.textContent = `${filteredEntries.length} catatan`;
            
            if (filteredEntries.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-${filter === 'private' ? 'file-alt' : 'globe'}"></i>
                        <p>Belum ada catatan ${filter === 'private' ? 'peribadi' : 'awam'}</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = '';
            filteredEntries.forEach(entry => {
                const entryCard = document.createElement('div');
                entryCard.className = 'entry-card';
                
                const entryDate = entry.date.toDate(); // Tukar Timestamp Firestore kepada Date
                const formattedDate = entryDate.toLocaleDateString('ms-MY', { day: 'numeric', month: 'long', year: 'numeric' });
                
                entryCard.innerHTML = `
                    <div class="entry-header">
                        <div class="entry-date">${formattedDate}</div>
                        <div class="entry-actions">
                            <button onclick="viewEntry('${entry.id}')">Lihat</button>
                            ${entry.author === currentUser ? `<button onclick="deleteEntry('${entry.id}')">Hapus</button>` : ''}
                        </div>
                    </div>
                    <h4>${entry.title}</h4>
                    <div class="entry-content">${entry.content.substring(0, 150)}${entry.content.length > 150 ? '...' : ''}</div>
                    ${entry.verse ? `<div class="entry-verse"><strong>Ayat:</strong> ${entry.verse.ref}</div>` : ''}
                    ${entry.author !== currentUser ? `<div style="margin-top: 10px; font-size: 0.85rem; color: #888;">Oleh: ${entry.author}</div>` : ''}
                `;
                container.appendChild(entryCard);
            });
        }

        function viewEntry(id) {
            const entry = journalEntries.find(e => e.id === id);
            if (!entry) return;
            
            modalTitle.textContent = entry.title;
            const entryDate = entry.date.toDate();
            const formattedDate = entryDate.toLocaleDateString('ms-MY', { day: 'numeric', month: 'long', year: 'numeric' });
            
            modalBody.innerHTML = `
                <p style="margin-bottom: 1rem; color: #666;">${formattedDate} | ${entry.visibility === 'public' ? 'Awam' : 'Peribadi'} ${entry.author !== currentUser ? `| Oleh: ${entry.author}` : ''}</p>
                <div style="margin-bottom: 1.5rem; white-space: pre-wrap;">${entry.content}</div>
                ${entry.verse ? `
                <div class="entry-verse">
                    <strong>Ayat Terkait:</strong>
                    <div style="margin-top: 0.5rem; font-style: italic; font-size: 1.1rem;">${entry.verse.text}</div>
                    <div style="margin-top: 0.5rem; font-style: italic; font-size: 1rem;">${entry.verse.translation}</div>
                    <div style="text-align: right; margin-top: 0.5rem; font-size: 0.9rem; font-weight: 500;">${entry.verse.ref}</div>
                </div>
                ` : ''}
            `;
            
            entryModal.classList.add('active');
        }

        // Initialize app when DOM is loaded
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
